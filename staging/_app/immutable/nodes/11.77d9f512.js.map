{"version":3,"file":"11.77d9f512.js","sources":["../../../../../../src/routes/guide/[guideId]/+page.ts","../../../../../../src/lib/components/guides/GuideInfo.svelte","../../../../../../src/lib/components/guides/GuideAuthor.svelte","../../../../../../src/routes/guide/[guideId]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { queryStore } from '@urql/svelte';\nimport { GetGuideDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    guide: queryStore({\n      query: GetGuideDocument,\n      client: (await parent()).client,\n      variables: { guide: params.guideId }\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import type { Guide } from '$lib/generated';\n  import Card, { Content } from '@smui/card';\n  import { prettyDate } from '$lib/utils/formatting';\n  import { getTranslate } from '@tolgee/svelte';\n\n  export let guide!: Pick<Guide, 'created_at'>;\n\n  export const { t } = getTranslate();\n</script>\n\n<Card>\n  <Content>\n    <div class=\"text-lg\">\n      <h3 class=\"text-2xl my-4 font-bold\">{$t('entry.info')}</h3>\n      <span><strong>{$t('entry.created-at')}:</strong> {prettyDate(guide.created_at)}</span><br />\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import type { User } from '$lib/generated';\n  import { base } from '$app/paths';\n  import Card, { Content } from '@smui/card';\n  import { getTranslate } from '@tolgee/svelte';\n\n  export let author: Pick<User, 'id' | 'username' | 'avatar'>;\n\n  export const { t } = getTranslate();\n</script>\n\n<Card>\n  <Content>\n    <div class=\"grid grid-flow-row gap-y-2\">\n      <h3 class=\"text-2xl my-4 font-bold\">{$t('author')}</h3>\n\n      <div class=\"grid auto-rows-min text-lg gap-y-4\">\n        <div class=\"grid grid-flow-col auto-cols-min gap-x-4\">\n          <div class=\"rounded-full bg-cover w-14 h-14\" style={`background-image: url(\"${author.avatar}\")`} />\n          <div class=\"grid grid-flow-row\">\n            <a href=\"{base}/user/{author.id}/\" class=\"text-yellow-500 underline\">{author.username}</a>\n            <div>{$t('role.writer')}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import { DeleteGuideDocument } from '$lib/generated';\n  import GuideInfo from '$lib/components/guides/GuideInfo.svelte';\n  import GuideAuthor from '$lib/components/guides/GuideAuthor.svelte';\n  import { user } from '$lib/stores/user';\n  import { goto } from '$app/navigation';\n  import { writable } from 'svelte/store';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { markdown } from '$lib/utils/markdown';\n  import { base } from '$app/paths';\n  import Dialog, { Title, Content as DialogContent } from '@smui/dialog';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n  import Button from '@smui/button';\n  import { getContextClient } from '@urql/svelte';\n  import type { PageData } from './$types';\n\n  export let data: PageData;\n\n  const { guideId, guide } = data;\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  $: canUserEdit = $user?.roles?.deleteContent || $user?.id === $guide?.data?.getGuide?.user?.id;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteGuideFn = () => {\n    client\n      .mutation(DeleteGuideDocument, { guideId })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error deleting guide: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          goto(base + '/guides');\n        }\n      });\n  };\n\n  $: if (!errorToast) {\n    errorMessage = '';\n  }\n</script>\n\n<svelte:head>\n  {#if !$guide.fetching && !$guide.error && $guide.data.getGuide}\n    <MetaDescriptors description={$guide.data.getGuide.short_description} title={$guide.data.getGuide.name} />\n  {/if}\n</svelte:head>\n\n{#if $guide.fetching}\n  <p>Loading...</p>\n{:else if $guide.error}\n  <p>Oh no... {$guide.error.message}</p>\n{:else if $guide.data.getGuide}\n  <div class=\"grid gap-6 xlx:grid-flow-row\">\n    <div class=\"flex flex-wrap h-auto justify-between items-center\">\n      <h1 class=\"text-4xl font-bold\">{$guide.data.getGuide.name}</h1>\n\n      <div>\n        {#if canUserEdit}\n          <Button variant=\"outlined\" on:click={() => goto(base + '/guide/' + guideId + '/edit')}>Edit</Button>\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(true)}>Delete</Button>\n        {/if}\n      </div>\n    </div>\n    <div class=\"grid grid-auto-max auto-cols-fr gap-4\">\n      <Card class=\"h-fit\">\n        <Content>\n          <div class=\"markdown-content break-words\">\n            {#await markdown($guide.data.getGuide.guide) then guideRendered}\n              <p>{@html guideRendered}</p>\n            {/await}\n          </div>\n        </Content>\n      </Card>\n      <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n        <GuideInfo guide={$guide.data.getGuide} />\n        <GuideAuthor author={$guide.data.getGuide.user} />\n      </div>\n    </div>\n  </div>\n\n  {#if canUserEdit}\n    <Dialog bind:open={$deleteDialogOpen}>\n      <Title>Delete Guide?</Title>\n      <DialogContent>\n        <div class=\"grid grid-flow-row gap-4\">\n          <span>Are you sure you wish to delete this guide</span>\n\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(false)}>Cancel</Button>\n          <Button variant=\"outlined\" on:click={() => deleteGuideFn()}>Delete</Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  {/if}\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n"],"names":["load","async","params","parent","n","loadWaitForNoFetch","guide","queryStore","query","GetGuideDocument","client","variables","guideId","t0_value","ctx","t2_value","prettyDate","created_at","insert_hydration_dev","target","div","anchor","append_hydration_dev","h3","span","strong","br","dirty","set_data_dev","t0","t2","t5","t5_value","$$props","t","getTranslate","t3_value","username","attr_dev","div0","div0_style_value","avatar","base","id","div5","div4","div3","div2","a","div1","t3","author","description","data","getGuide","short_description","title","name","metadescriptors_changes","create_if_block_4","user","create_if_block_3","h1","current","guideauthor_changes","error","message","p","t1","t1_value","innerHTML","raw_value","handle_promise","promise","markdown","info","fetching","create_if_block_5","getContextClient","errorMessage","errorToast","deleteDialogOpen","writable","deleteGuideFn","mutation","DeleteGuideDocument","toPromise","then","value","console","$$invalidate","goto","click_handler","set","$deleteDialogOpen","canUserEdit","$user","roles","deleteContent","$guide"],"mappings":"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"}
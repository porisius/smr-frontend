{"version":3,"file":"edit.svelte-77bb57d4.js","sources":["../../../../../../../../src/routes/mod/[modId]/edit.svelte"],"sourcesContent":["<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n\n  export const load = paramsToProps();\n</script>\n\n<script lang=\"ts\">\n  import { mutation, operationStore, query } from '@urql/svelte';\n  import { EditModDocument, GetModDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import ModForm from '$lib/components/mods/ModForm.svelte';\n  import type { ModData } from '$lib/models/mods';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n  import { get } from 'svelte/store';\n\n  export let modId!: string;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const mod = operationStore(GetModDocument, { mod: modId });\n\n  const editMod = mutation({\n    query: EditModDocument\n  });\n\n  const onSubmit = (data: ModData) => {\n    editMod({\n      modId: get(mod).data.mod.id,\n      mod: data\n    }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error editing mod: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        goto(base + '/mod/' + value.data.updateMod.id);\n      }\n    });\n  };\n\n  $: if (!errorToast) errorMessage = '';\n\n  $: initialValues = $mod.data\n    ? {\n        ...$mod.data.mod,\n        logo: undefined\n      }\n    : undefined;\n\n  query(mod);\n</script>\n\n<svelte:head>\n  {#if !$mod.fetching && !$mod.error && $mod.data.mod}\n    <MetaDescriptors\n      description=\"Editing mod {$mod.data.mod.name}\"\n      title=\"Edit mod {$mod.data.mod.name}\"\n      image={$mod.data.mod.logo}\n    />\n  {/if}\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Mod</h1>\n\n<Card>\n  <Content>\n    {#if $mod.fetching}\n      <p>Loading...</p>\n    {:else if $mod.error}\n      <p>Oh no... {$mod.error.message}</p>\n    {:else}\n      <ModForm {onSubmit} {initialValues} editing={true} submitText=\"Save\" />\n    {/if}\n  </Content>\n</Card>\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["description","ctx","data","mod","name","title","image","logo","dirty","metadescriptors_changes","error","message","insert_hydration_dev","target","p","anchor","set_data_dev","t1","t1_value","fetching","span","create_if_block_2","h1","load","paramsToProps","modId","$$props","errorMessage","errorToast","operationStore","GetModDocument","editMod","mutation","query","EditModDocument","onSubmit","get","id","then","value","console","$$invalidate","goto","base","updateMod","initialValues","$mod","undefined"],"mappings":"onCA4DgCA,YAAA,eAAAC,EAAK,GAAAC,KAAKC,IAAIC,KACvBC,MAAA,YAAAJ,EAAK,GAAAC,KAAKC,IAAIC,KACxBE,MAAAL,EAAK,GAAAC,KAAKC,IAAII,sJAFK,EAAA,AAAAC,EAAA,GAAAC,GAAAT,YAAA,eAAAC,EAAK,GAAAC,KAAKC,IAAIC,MACvBI,EAAA,GAAAC,GAAAJ,MAAA,YAAAJ,EAAK,GAAAC,KAAKC,IAAIC,MACxBI,EAAA,GAAAC,GAAAH,MAAAL,EAAK,GAAAC,KAAKC,IAAII,uVAcwB,mbAFhCN,EAAI,GAACS,MAAMC,QAAO,wCAA5B,WAAA,gEAAA,WAAA,iFAAHC,EAAmCC,EAAAC,EAAAC,CAAAA,6CAAtBd,EAAI,GAACS,MAAMC,QAAO,KAAAK,GAAAC,EAAAC,uLAF5B,qEAAA,oFAAHN,EAAgBC,EAAAC,EAAAC,6NADb,MAAAd,MAAKkB,SAAQ,EAERlB,KAAKS,MAAK,m/BASfT,EAAY,8DAAZA,EAAY,0EAAnBW,EAA0BC,EAAAO,EAAAL,qCAAnBd,EAAY,iMAxBbA,EAAI,GAACkB,WAAalB,EAAI,GAACS,OAAST,EAAI,GAACC,KAAKC,KAAGkB,EAAApB,8IAuBhCA,EAAU,KAAA,mBAAVA,EAAU,4HAdK,UAAA,8MAAA,mOAApCW,EAAAA,EAAgDC,EAAAS,EAAAP,CAAAA,sEATxCd,EAAI,GAACkB,UAAalB,CAAAA,EAAI,GAACS,OAAST,EAAI,GAACC,KAAKC,0OAuB7BF,EAAU,mUA9EhB,KAAAsB,IAAOC,GAAAA,kFAeTC,GAAcC,EAErBC,EAAe,GACfC,EAAa,GAEX,KAAAzB,GAAM0B,EAAeC,EAAkB,CAAA3B,IAAKsB,CAAAA,CAAAA,kCAE5C,KAAAM,GAAUC,EACd,CAAAC,MAAOC,CAAAA,CAAAA,EAGHC,EAAYjC,GAAAA,CAChB6B,GACEN,MAAOW,EAAIjC,GAAKD,KAAKC,IAAIkC,GACzBlC,IAAKD,CACJoC,CAAAA,EAAAA,KAAMC,IACH,AAAAA,EAAM7B,MACR8B,SAAQ9B,MAAM6B,EAAM7B,MAAMC,OAAAA,EAC1B8B,EAAA,EAAAd,EAAe,sBAAwBY,EAAM7B,MAAMC,OACnD8B,EAAAA,EAAA,EAAAb,EAAa,KAGbc,EAAKC,EAAO,QAAUJ,EAAMrC,KAAK0C,UAAUP,EAcjDJ,CAAAA,CAAAA,CAAAA,EAAAA,EAAM9B,uKA2BayB,CAAAA,EAAUW,+kBApCrBX,IAAYa,EAAA,EAAAd,EAAe,EAAA,iBAEhCc,EAAA,EAAAI,EAAgBC,EAAK5C,KAEf,CAAA4C,GAAAA,EAAK5C,KAAKC,IACbI,KAAMwC,MAERA,EAAAA,MAAAA,CAAAA"}
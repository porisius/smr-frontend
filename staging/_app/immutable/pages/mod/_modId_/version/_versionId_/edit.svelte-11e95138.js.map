{"version":3,"file":"edit.svelte-11e95138.js","sources":["../../../../../../../../../../src/routes/mod/[modId]/version/[versionId]/edit.svelte"],"sourcesContent":["<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n\n  export const load = paramsToProps();\n</script>\n\n<script lang=\"ts\">\n  import { mutation, operationStore, query } from '@urql/svelte';\n  import { GetModVersionDocument, UpdateVersionDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import VersionForm from '$lib/components/versions/VersionForm.svelte';\n  import type { VersionData } from '$lib/models/versions';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n\n  export let modId!: string;\n  export let versionId!: string;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const version = operationStore(GetModVersionDocument, { version: versionId });\n\n  const editVersion = mutation({\n    query: UpdateVersionDocument\n  });\n\n  const onSubmit = async (data: VersionData) => {\n    return editVersion({\n      versionId: versionId,\n      version: data\n    }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error editing version: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        return goto(base + '/mod/' + modId + '/version/' + versionId);\n      }\n    });\n  };\n\n  $: if (!errorToast) errorMessage = '';\n\n  $: initialValues = $version.data\n    ? {\n        ...$version.data.getVersion,\n        logo: undefined\n      }\n    : undefined;\n\n  query(version);\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Editing mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Edit mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n    />\n  {/if}\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Version</h1>\n\n<Card>\n  <Content>\n    {#if $version.fetching}\n      <p>Loading...</p>\n    {:else if $version.error}\n      <p>Oh no... {$version.error.message}</p>\n    {:else}\n      <VersionForm\n        {onSubmit}\n        {initialValues}\n        modReference={$version.data.getVersion.mod.mod_reference}\n        editing={true}\n        submitText=\"Save\"\n      />\n    {/if}\n  </Content>\n</Card>\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["description","ctx","data","getVersion","mod","name","version","title","dirty","metadescriptors_changes","modReference","mod_reference","versionform_changes","error","message","insert_hydration_dev","target","p","anchor","set_data_dev","t1","t1_value","fetching","span","create_if_block_2","h1","load","paramsToProps","modId","$$props","versionId","errorMessage","errorToast","operationStore","GetModVersionDocument","editVersion","mutation","query","UpdateVersionDocument","onSubmit","then","value","console","$$invalidate","goto","base","initialValues","$version","logo","undefined"],"mappings":"s8CA4DwCA,YAAA,uBAAAC,EAAS,GAAAC,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,GAAAC,KAAKC,WAAWG,QACtEC,MAAA,oBAAAN,EAAS,GAAAC,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,GAAAC,KAAKC,WAAWG,yJADpD,EAAA,AAAAE,EAAA,GAAAC,GAAAT,YAAA,uBAAAC,EAAS,GAAAC,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,GAAAC,KAAKC,WAAWG,SACtEE,EAAA,GAAAC,GAAAF,MAAA,oBAAAN,EAAS,GAAAC,KAAKC,WAAWC,IAAIC,KAAI,IAAGJ,EAAS,GAAAC,KAAKC,WAAWG,qWAiBtEI,aAAAT,KAASC,KAAKC,WAAWC,IAAIO,sBAClC,oMADKH,EAAA,GAAAI,GAAAF,aAAAT,KAASC,KAAKC,WAAWC,IAAIO,8PALhCV,EAAQ,GAACY,MAAMC,QAAO,wCAAhC,WAAA,gEAAA,4FAAHC,EAAuCC,EAAAC,EAAAC,CAAAA,6CAA1BjB,EAAQ,GAACY,MAAMC,QAAO,KAAAK,GAAAC,EAAAC,CAAAA,CAAAA,qLAFhC,qEAAA,mFAAHN,CAAAA,EAAgBC,EAAAC,EAAAC,iOADb,MAAAjB,MAASqB,SAAQ,EAEZrB,KAASY,MAAK,o/BAenBZ,EAAY,8DAAZA,EAAY,EAAA,wEAAnBc,EAA0BC,EAAAO,EAAAL,CAAAA,oCAAnBjB,EAAY,gMA7BbA,CAAAA,EAAQ,GAACqB,UAAAA,CAAarB,EAAQ,GAACY,OAASZ,EAAQ,GAACC,KAAKC,YAAUqB,EAAAvB,8IA4BnDA,EAAU,KAAA,mBAAVA,EAAU,4HApBK,6NAAA,cAAA,2NAApCc,EAAoDC,EAAAS,EAAAP,CAAAA,qEAR5CjB,CAAAA,EAAQ,GAACqB,UAAarB,CAAAA,EAAQ,GAACY,OAASZ,EAAQ,GAACC,KAAKC,mPA4BzCF,EAAU,mUAnFhB,KAAAyB,IAAOC,qFAcTC,GAAcC,aACdC,GAAkBD,EAEzBE,EAAe,GACfC,EAAa,GAEX,KAAA1B,GAAU2B,EAAeC,EAAyB,CAAA5B,QAASwB,CAAAA,CAAAA,mCAE3D,CAAA,EAAA,KAAAK,GAAcC,EAClB,CAAAC,MAAOC,CAAAA,CAAAA,EAGHC,OACGJ,IAAAA,EAAW,CACLL,UACXxB,EAAAA,QAASJ,CACRsC,CAAAA,EAAAA,KAAMC,GACH,CAAA,GAAAA,EAAM5B,MACR6B,QAAQ7B,MAAM4B,EAAM5B,MAAMC,SAC1B6B,EAAA,EAAAZ,EAAe,0BAA4BU,EAAM5B,MAAMC,SACvD6B,EAAA,EAAAX,EAAa,EAAA,aAGNY,GAAKC,EAAO,QAAUjB,EAAQ,YAAcE,CAczDO,CAAAA,CAAAA,EAAAA,EAAM/B,mLAgCa0B,EAAUS,0rBAzCrBT,IAAYW,EAAA,EAAAZ,EAAe,mBAEhCY,EAAA,EAAAG,EAAgBC,EAAS7C,MAEnB6C,GAAAA,EAAS7C,KAAKC,WACjB6C,KAAMC,MAERA,EAAAA,MAAAA,CAAAA"}
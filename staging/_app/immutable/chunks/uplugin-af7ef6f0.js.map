{"version":3,"file":"uplugin-af7ef6f0.js","sources":["../../../../../../src/lib/utils/uplugin.ts"],"sourcesContent":["import { Validator } from '@cfworker/json-schema';\nimport { API_BASE } from '$lib/core';\n\nlet resolver;\nconst uPluginValidator = new Promise<Validator>((r) => (resolver = r));\n\nfetch(API_BASE + '/static/uplugin-json-schema.json')\n  .then((response) => response.json())\n  .then((json) => resolver(new Validator(json)));\n\nconst resolveValue = (object: unknown, path: string) => {\n  const parser = new RegExp(`\\\\['?(.+?)'?\\\\]|\\\\.([^\\\\.\\\\[\\\\]]+)`, `gm`);\n\n  try {\n    let value = object;\n    let key = parser.exec(path);\n    while (key !== null) {\n      value = value[key[1] || key[2]];\n      key = parser.exec(path);\n    }\n    return value;\n  } catch (e) {\n    // Ignore exception\n  }\n\n  return undefined;\n};\n\nexport const validateUPluginJson = async (input: string): Promise<string[]> => {\n  const validator = await uPluginValidator;\n\n  try {\n    const objInput = JSON.parse(input);\n    const result = validator.validate(objInput);\n\n    if (result.valid) {\n      return [];\n    }\n\n    return result.errors\n      .map((error) => {\n        if (error.keyword === '$ref') {\n          return undefined;\n        }\n\n        let message = '`' + error.instanceLocation + '`';\n\n        const value = resolveValue(objInput, error.instanceLocation);\n\n        if (typeof value !== 'object') {\n          message += ' **\"' + value + '\"**';\n        }\n\n        message += ': ' + error.error;\n\n        return message;\n      })\n      .filter((v) => !!v);\n  } catch (e) {\n    return ['Invalid JSON'];\n  }\n};\n"],"names":["resolver","uPluginValidator","Promise","r","fetch","API_BASE","then","response","json","Validator","resolveValue","object","path","parser","RegExp","value","key","exec","e","validateUPluginJson","async","input","validator","objInput","JSON","parse","result","validate","valid","errors","map","error","keyword","message","instanceLocation","filter","v"],"mappings":"uIAGA,GAAIA,GACJ,KAAMC,GAAmB,GAAIC,SAAoBC,GAAOH,EAAWG,CAEnEC,EAAAA,MAAMC,EAAW,kCAAA,EACdC,KAAMC,GAAaA,EAASC,KAAAA,CAAAA,EAC5BF,KAAME,GAASR,EAAS,GAAIS,GAAUD,CAEzC,CAAA,CAAA,EAAA,KAAME,GAAe,CAACC,EAAiBC,IACrC,CAAA,KAAMC,GAAS,GAAIC,QAAO,qCAAsC,IAE5D,EAAA,GAAA,CACF,GAAIC,GAAQJ,EACRK,EAAMH,EAAOI,KAAKL,CAAAA,EACtB,KAAOI,IAAQ,MACLD,EAAAA,EAAMC,EAAI,IAAMA,EAAI,IACtBA,EAAAH,EAAOI,KAAKL,CAAAA,EAEb,MAAAG,EAAAA,OACAG,CAOE,EAAAC,EAAsBC,KAAOC,IACxC,CAAA,KAAMC,GAAkBrB,KAAAA,GAEpB,GACI,CAAA,KAAAsB,GAAWC,KAAKC,MAAMJ,CAAAA,EACtBK,EAASJ,EAAUK,SAASJ,CAAAA,EAElC,MAAIG,GAAOE,MACF,CAAA,EAGFF,EAAOG,OACXC,IAAKC,GAAAA,CACA,GAAAA,EAAMC,UAAY,OACb,OAGL,GAAAC,GAAU,IAAMF,EAAMG,iBAAmB,IAE7C,KAAMnB,GAAQL,EAAaa,EAAUQ,EAAMG,gBAAAA,EAEvC,MAAOnB,OAAAA,IAAU,UACnBkB,IAAW,OAASlB,EAAQ,OAG9BkB,GAAW,KAAOF,EAAMA,MAEjBE,CAAAA,CAAAA,EAERE,OAAQC,GAAAA,CAAAA,CAAQA,SAEnB,MAAO,CAAC"}
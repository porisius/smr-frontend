{"version":3,"file":"uplugin.7e0738e4.js","sources":["../../../../../../src/lib/utils/uplugin.ts"],"sourcesContent":["import { Validator } from '@cfworker/json-schema';\nimport { API_BASE } from '$lib/core';\n\nlet resolver;\nconst uPluginValidator = new Promise<Validator>((r) => (resolver = r));\n\nfetch(API_BASE + '/static/uplugin-json-schema.json')\n  .then((response) => response.json())\n  .then((json) => resolver(new Validator(json)));\n\nconst resolveValue = (object: unknown, path: string) => {\n  const parser = new RegExp(`\\\\['?(.+?)'?\\\\]|\\\\.([^\\\\.\\\\[\\\\]]+)`, `gm`);\n\n  try {\n    let value = object;\n    let key = parser.exec(path);\n    while (key !== null) {\n      value = value[key[1] || key[2]];\n      key = parser.exec(path);\n    }\n    return value;\n  } catch (e) {\n    // Ignore exception\n  }\n\n  return undefined;\n};\n\nexport const validateUPluginJson = async (input: string): Promise<string[]> => {\n  const validator = await uPluginValidator;\n\n  try {\n    const objInput = JSON.parse(input);\n    const result = validator.validate(objInput);\n\n    if (result.valid) {\n      return [];\n    }\n\n    return result.errors\n      .map((error) => {\n        if (error.keyword === '$ref') {\n          return undefined;\n        }\n\n        let message = '`' + error.instanceLocation + '`';\n\n        const value = resolveValue(objInput, error.instanceLocation);\n\n        if (typeof value !== 'object') {\n          message += ' **\"' + value + '\"**';\n        }\n\n        message += ': ' + error.error;\n\n        return message;\n      })\n      .filter((v) => !!v);\n  } catch (e) {\n    return ['Invalid JSON'];\n  }\n};\n"],"names":["resolver","uPluginValidator","Promise","r","fetch","API_BASE","then","response","json","Validator","resolveValue","object","path","parser","RegExp","value","key","exec","validateUPluginJson","async","input","validator","objInput","JSON","parse","result","validate","valid","errors","map","error","keyword","message","instanceLocation","filter","v"],"mappings":"uIAGA,IAAIA,EACJ,MAAMC,EAAmB,IAAIC,QAAoBC,GAAOH,EAAWG,GAEnEC,MAAMC,EAAW,kCACdC,EAAAA,KAAMC,GAAaA,EAASC,KAC5BF,CAAAA,EAAAA,KAAME,GAASR,EAAS,IAAIS,EAAUD,CAAAA,CAAAA,CAAAA,EAEzC,MAAME,EAAe,CAACC,EAAiBC,IAAAA,CACrC,MAAMC,EAAS,IAAIC,OAAO,qCAAsC,IAE5D,EAAA,GAAA,CACF,IAAIC,EAAQJ,EACRK,EAAMH,EAAOI,KAAKL,GACtB,KAAOI,IAAQ,MACbD,EAAQA,EAAMC,EAAI,CAAMA,GAAAA,EAAI,CACtBA,CAAAA,EAAAA,EAAAH,EAAOI,KAAKL,GAEb,OAAAG,QAGT,CAEO,EAGIG,EAAsBC,MAAOC,GAAAA,CACxC,MAAMC,EAAAA,MAAkBpB,EAEpB,GAAA,CACI,MAAAqB,EAAWC,KAAKC,MAAMJ,CAAAA,EACtBK,EAASJ,EAAUK,SAASJ,GAElC,OAAIG,EAAOE,MACF,CAAA,EAGFF,EAAOG,OACXC,IAAKC,GACA,CAAA,GAAAA,EAAMC,UAAY,OACb,OAGL,IAAAC,EAAU,IAAMF,EAAMG,iBAAmB,IAE7C,MAAMlB,EAAQL,EAAaY,EAAUQ,EAAMG,gBAAAA,EAEvC,cAAOlB,GAAU,WACnBiB,GAAW,OAASjB,EAAQ,OAG9BiB,GAAW,KAAOF,EAAMA,MAEjBE,CAAA,CAERE,EAAAA,OAAQC,GAAQA,CAAAA,CAAAA,CAAAA,QAEnB,MAAO,CAAC,eACV"}
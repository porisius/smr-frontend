{"version":3,"file":"13.aacbe3f3.js","sources":["../../../../../../src/routes/guide/[guideId]/edit/+page.ts","../../../../../../src/routes/guide/[guideId]/edit/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\n\nexport const load: PageLoad = async ({ params }) => ({\n  ...params\n});\n","<script lang=\"ts\">\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import { EditGuideDocument, GetGuideDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import GuideForm from '$lib/components/guides/GuideForm.svelte';\n  import Card, { Content } from '@smui/card';\n  import type { GuideData } from '$lib/models/guides';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import type { PageData } from './$types';\n\n  export let data: PageData;\n\n  $: ({ guideId } = data);\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  $: guide = queryStore({\n    query: GetGuideDocument,\n    client,\n    variables: { guide: guideId }\n  });\n\n  const onSubmit = (guideData: GuideData) => {\n    client\n      .mutation(EditGuideDocument, {\n        guideId: guideId,\n        guide: guideData\n      })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error editing guide: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          goto(base + '/guide/' + value.data.updateGuide.id);\n        }\n      });\n  };\n\n  $: if (!errorToast) {\n    errorMessage = '';\n  }\n</script>\n\n<svelte:head>\n  {#if !$guide.fetching && !$guide.error && $guide.data.getGuide}\n    <MetaDescriptors\n      description=\"Editing guide '{$guide.data.getGuide.short_description}'\"\n      title=\"Edit guide '{$guide.data.getGuide.name}'\" />\n  {/if}\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Guide</h1>\n\n<Card>\n  <Content>\n    {#if $guide.fetching}\n      <p>Loading...</p>\n    {:else if $guide.error}\n      <p>Oh no... {$guide.error.message}</p>\n    {:else}\n      <GuideForm {onSubmit} initialValues={$guide.data.getGuide} submitText=\"Save\" />\n    {/if}\n  </Content>\n</Card>\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["load","async","params","description","ctx","data","getGuide","short_description","title","name","dirty","metadescriptors_changes","error","message","insert_hydration","target","p","anchor","set_data","t1","t1_value","fetching","span","create_if_block_2","h1","$$props","client","getContextClient","errorMessage","errorToast","onSubmit","guideData","mutation","EditGuideDocument","guideId","guide","toPromise","then","value","console","$$invalidate","goto","base","updateGuide","id","$$subscribe_guide","queryStore","query","GetGuideDocument","variables"],"mappings":"wgBAEO,MAAMA,GAAiBC,MAAAA,CAASC,aAAc,CAChDA,GAAAA,CAAAA,uJCmD8BC,YAAA,kBAAAC,EAAO,CAAAC,EAAAA,KAAKC,SAASC,kBAAiB,IAC/CC,MAAA,eAAAJ,EAAO,CAAA,EAAAC,KAAKC,SAASG,KAAI,+FADhBC,EAAA,IAAAC,EAAAR,YAAA,kBAAAC,EAAO,GAAAC,KAAKC,SAASC,kBAAiB,KAC/CG,EAAA,IAAAC,EAAAH,MAAA,eAAAJ,EAAO,CAAAC,EAAAA,KAAKC,SAASG,KAAI,0KAaRL,EAAM,CAAA,EAACC,KAAKC,4IAAZF,EAAM,GAACC,KAAKC,6HAFpCF,EAAM,CAACQ,EAAAA,MAAMC,QAAO,6BAA9B,yDAAA,WAAA,gCAAHC,EAAqCC,EAAAC,EAAAC,qCAAxBb,EAAM,CAAA,EAACQ,MAAMC,QAAO,KAAAK,EAAAC,EAAAC,0EAF9B,YAAA,uCAAA,mCAAHN,EAAgBC,EAAAC,EAAAC,yGADb,OAAAb,KAAOiB,SAAQ,EAEVjB,KAAOQ,MAAK,wpBASjBR,EAAY,4CAAZA,EAAY,wBAAnBU,CAAAA,EAA0BC,EAAAO,EAAAL,2BAAnBb,EAAY,8DAtBbA,EAAM,CAACiB,EAAAA,UAAAA,CAAajB,EAAM,CAAA,EAACQ,OAASR,EAAM,CAAA,EAACC,KAAKC,UAAQiB,EAAAnB,yIAqB3CA,EAAU,CAAA,IAAA,mBAAVA,EAAU,6FAdK,YAAA,oLAAA,YAAA,uLAApCU,EAAkDC,EAAAS,EAAAP,8DAP1Cb,EAAM,CAACiB,EAAAA,UAAAA,CAAajB,EAAM,CAACQ,EAAAA,OAASR,EAAM,CAACC,EAAAA,KAAKC,8OAqBnCF,EAAU,yTA7DlBC,GAAcoB,EAInB,MAAAC,EAASC,EAAAA,EAEX,IAAAC,EAAe,GACfC,EAAa,GAQX,MAAAC,EAAYC,GAAAA,CAChBL,EACGM,SAASC,IACCC,QAAAA,EACTC,MAAOJ,CAERK,CAAAA,EAAAA,UAAAA,EACAC,KAAMC,GACD,CAAAA,EAAM1B,OACR2B,QAAQ3B,MAAM0B,EAAM1B,MAAMC,OAAAA,EAC1B2B,EAAA,EAAAZ,EAAe,wBAA0BU,EAAM1B,MAAMC,OACrD2B,EAAAA,EAAA,EAAAX,EAAa,EAAA,GAGbY,EAAKC,GAAO,UAAYJ,EAAMjC,KAAKsC,YAAYC,qBAgCpCf,EAAUS,uFA3D5BE,EAAA,GAAKN,QAAY7B,CAAAA,EAAAA,EAAI6B,kBAOrBW,EAAAL,EAAA,EAAEL,EAAQW,EAAU,CACnBC,MAAOC,GACPtB,SACAuB,UAAS,CAAId,MAAOD,sBAsBdL,GACNW,EAAA,EAAAZ,EAAe,EAAA"}
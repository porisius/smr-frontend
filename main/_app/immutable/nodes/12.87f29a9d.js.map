{"version":3,"file":"12.87f29a9d.js","sources":["../../../../../../src/routes/guide/[guideId]/+page.ts","../../../../../../src/lib/components/guides/GuideInfo.svelte","../../../../../../src/lib/components/guides/GuideAuthor.svelte","../../../../../../src/routes/guide/[guideId]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { queryStore } from '@urql/svelte';\nimport { GetGuideDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    guide: queryStore({\n      query: GetGuideDocument,\n      client: (await parent()).client,\n      variables: { guide: params.guideId }\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import type { Guide } from '$lib/generated';\n  import Card, { Content } from '@smui/card';\n  import { prettyDate } from '$lib/utils/formatting';\n\n  export let guide!: Pick<Guide, 'created_at'>;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"text-lg\">\n      <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n      <span><strong>Created:</strong> {prettyDate(guide.created_at)}</span><br />\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import type { User } from '$lib/generated';\n  import { base } from '$app/paths';\n  import Card, { Content } from '@smui/card';\n\n  export let author: Pick<User, 'id' | 'username' | 'avatar'>;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"grid grid-flow-row gap-y-2\">\n      <h3 class=\"text-2xl my-4 font-bold\">Author</h3>\n\n      <div class=\"grid auto-rows-min text-lg gap-y-4\">\n        <div class=\"grid grid-flow-col auto-cols-min gap-x-4\">\n          <div class=\"rounded-full bg-cover w-14 h-14\" style={`background-image: url(\"${author.avatar}\")`} />\n          <div class=\"grid grid-flow-row\">\n            <a href=\"{base}/user/{author.id}/\" class=\"text-yellow-500 underline\">{author.username}</a>\n            <div>Writer</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import { DeleteGuideDocument } from '$lib/generated';\n  import GuideInfo from '$lib/components/guides/GuideInfo.svelte';\n  import GuideAuthor from '$lib/components/guides/GuideAuthor.svelte';\n  import { user } from '$lib/stores/user';\n  import { goto } from '$app/navigation';\n  import { writable } from 'svelte/store';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { markdown } from '$lib/utils/markdown';\n  import { base } from '$app/paths';\n  import Dialog, { Title, Content as DialogContent } from '@smui/dialog';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n  import Button from '@smui/button';\n  import { getContextClient } from '@urql/svelte';\n  import type { PageData } from './$types';\n\n  export let data: PageData;\n\n  $: ({ guideId, guide } = data);\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  $: canUserEdit = $user?.roles?.deleteContent || $user?.id === $guide?.data?.getGuide?.user?.id;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteGuideFn = () => {\n    client\n      .mutation(DeleteGuideDocument, { guideId })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error deleting guide: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          goto(base + '/guides');\n        }\n      });\n  };\n\n  $: if (!errorToast) {\n    errorMessage = '';\n  }\n</script>\n\n<svelte:head>\n  {#if !$guide.fetching && !$guide.error && $guide.data.getGuide}\n    <MetaDescriptors description={$guide.data.getGuide.short_description} title={$guide.data.getGuide.name} />\n  {/if}\n</svelte:head>\n\n{#if $guide.fetching}\n  <p>Loading...</p>\n{:else if $guide.error}\n  <p>Oh no... {$guide.error.message}</p>\n{:else if $guide.data.getGuide}\n  <div class=\"grid gap-6 xlx:grid-flow-row\">\n    <div class=\"flex flex-wrap h-auto justify-between items-center\">\n      <h1 class=\"text-4xl font-bold\">{$guide.data.getGuide.name}</h1>\n\n      <div>\n        {#if canUserEdit}\n          <Button variant=\"outlined\" on:click={() => goto(base + '/guide/' + guideId + '/edit')}>Edit</Button>\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(true)}>Delete</Button>\n        {/if}\n      </div>\n    </div>\n    <div class=\"grid grid-auto-max auto-cols-fr gap-4\">\n      <Card class=\"h-fit\">\n        <Content>\n          <div class=\"markdown-content break-words\">\n            {#await markdown($guide.data.getGuide.guide) then guideRendered}\n              <p>{@html guideRendered}</p>\n            {/await}\n          </div>\n        </Content>\n      </Card>\n      <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n        <GuideInfo guide={$guide.data.getGuide} />\n        <GuideAuthor author={$guide.data.getGuide.user} />\n      </div>\n    </div>\n  </div>\n\n  {#if canUserEdit}\n    <Dialog bind:open={$deleteDialogOpen}>\n      <Title>Delete Guide?</Title>\n      <DialogContent>\n        <div class=\"grid grid-flow-row gap-4\">\n          <span>Are you sure you wish to delete this guide</span>\n\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(false)}>Cancel</Button>\n          <Button variant=\"outlined\" on:click={() => deleteGuideFn()}>Delete</Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  {/if}\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n"],"names":["load","async","params","parent","loadWaitForNoFetch","guide","queryStore","query","GetGuideDocument","client","variables","guideId","prettyDate","ctx","created_at","insert_hydration","target","div","anchor","append_hydration","h3","span","strong","br","set_data","t4","t4_value","$$props","t3_value","username","attr","div0","div0_style_value","avatar","base","id","div5","div4","div3","div2","a","div1","dirty","t3","author","description","data","getGuide","short_description","title","name","metadescriptors_changes","t0_value","create_if_block_4","user","create_if_block_3","h1","current","t0","guideauthor_changes","error","message","p","t1","t1_value","innerHTML","raw_value","handle_promise","promise","markdown","info","fetching","create_if_block_5","getContextClient","errorMessage","errorToast","deleteDialogOpen","writable","deleteGuideFn","mutation","DeleteGuideDocument","toPromise","then","value","console","$$invalidate","goto","click_handler","set","$deleteDialogOpen","$$subscribe_guide","canUserEdit","$user","roles","deleteContent","$guide"],"mappings":"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"}